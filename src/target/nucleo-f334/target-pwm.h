#include "target.h"

#define PWM_GPIO_PORT GPIOA
#define PWM_GPIO_RCC RCC_GPIOA
#define PWM_GPIO_PIN GPIO15
#define PWM_GPIO_AF GPIO_AF2

#define PWM_TIMER TIM8
#define PWM_TIMER_RCC RCC_TIM8
#define PWM_TIMER_OC_ID TIM_OC1
#define PWM_TIMER_OCM TIM_OCM_PWM1

#define PWM_TIMER_IC_ID_RISE TIM_IC1
#define PWM_TIMER_IC_ID_FALL TIM_IC2
#define PWM_TIMER_IC_IN TIM_IC_IN_TI1 // trigger input
#define PWM_TIMER_SLAVE_MODE TIM_SMCR_SMS_RM
#define PWM_TIMER_SLAVE_TS TIM_SMCR_TS_TI1FP1

#define PWM_TIMER_OC_ID_FALL TIM_OC2

#define PWM_DMA DMA2
#define PWM_DMA_RCC RCC_DMA2
#define PWM_DMA_CHANNEL DMA_CHANNEL3
#define PWM_DMA_PERIPH TIM_CCR1(PWM_TIMER)
// TIM8 is a 16 bit counter, with 16 bit CCR registers
#define PWM_DMA_PERIPH_SIZE DMA_CCR_PSIZE_16BIT
#define PWM_DMA_REQUEST TIM_DIER_CC1DE
